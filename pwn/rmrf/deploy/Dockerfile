FROM ubuntu:latest
RUN sed -i 's/archive.ubuntu.com/download.nus.edu.sg\/mirror/g' /etc/apt/sources.list
RUN apt-get update
RUN apt-get -y upgrade
RUN apt-get install -y openssh-server
RUN mkdir /var/run/sshd
RUN echo 'root:screencast' | chpasswd
RUN sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# SSH login fix. Otherwise user is kicked off after login
RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd

ENV NOTVISIBLE "in users profile"
RUN echo "export VISIBLE=now" >> /etc/profile

RUN useradd -m rmrf
RUN echo rmrf:rmrf | chpasswd
RUN echo IyEvYmluL2Jhc2gKY2hyb290IC0tdXNlcnNwZWM9MTAwMCAvbm90aGluZyAvYmluL3NoCg== | base64 -d > /bin/chrsh
RUN chmod +x /bin/chrsh
RUN chsh -s /bin/chrsh rmrf
RUN chmod +s `which chroot`

RUN mkdir /nothing
RUN mkdir /nothing/bin/
RUN mkdir /nothing/proc/
RUN mkdir /nothing/lib/
RUN mkdir /nothing/dev/
RUN mkdir /nothing/lib64/
RUN mount --bind /dev/ /nothing/dev/;return 0
RUN mount --bind /proc/ /nothing/proc/;return 0
RUN cp /bin/sh /nothing/bin/sh
RUN mkdir /nothing/lib/x86_64-linux-gnu/
RUN cp /lib/x86_64-linux-gnu/libtinfo.so.5 /nothing/lib/x86_64-linux-gnu/libtinfo.so.5
RUN cp /lib/x86_64-linux-gnu/libdl.so.2 /nothing/lib/x86_64-linux-gnu/libdl.so.2
RUN cp /lib/x86_64-linux-gnu/libc.so.6 /nothing/lib/x86_64-linux-gnu/libc.so.6
RUN cp /lib64/ld-linux-x86-64.so.2 /nothing/lib64/ld-linux-x86-64.so.2

RUN touch /nothing/dev/autofs /nothing/dev/block /nothing/dev/bsg /nothing/dev/btrfs-control /nothing/dev/bus /nothing/dev/cdrom /nothing/dev/cdrw /nothing/dev/char /nothing/dev/console /nothing/dev/core /nothing/dev/cpu /nothing/dev/cpu_dma_latency /nothing/dev/cuse /nothing/dev/disk /nothing/dev/dri /nothing/dev/dvd /nothing/dev/dvdrw /nothing/dev/ecryptfs /nothing/dev/fb0 /nothing/dev/fb1 /nothing/dev/fd /nothing/dev/full /nothing/dev/fuse /nothing/dev/hidraw0 /nothing/dev/hpet /nothing/dev/hugepages /nothing/dev/hwrng /nothing/dev/i2c-0 /nothing/dev/i2c-1 /nothing/dev/i2c-10 /nothing/dev/i2c-11 /nothing/dev/i2c-12 /nothing/dev/i2c-13 /nothing/dev/i2c-14 /nothing/dev/i2c-15 /nothing/dev/i2c-16 /nothing/dev/i2c-17 /nothing/dev/i2c-18 /nothing/dev/i2c-2 /nothing/dev/i2c-3 /nothing/dev/i2c-4 /nothing/dev/i2c-5 /nothing/dev/i2c-6 /nothing/dev/i2c-7 /nothing/dev/i2c-8 /nothing/dev/i2c-9 /nothing/dev/initctl /nothing/dev/input /nothing/dev/kmsg /nothing/dev/kvm /nothing/dev/log /nothing/dev/loop0 /nothing/dev/loop1 /nothing/dev/loop2 /nothing/dev/loop3 /nothing/dev/loop4 /nothing/dev/loop5 /nothing/dev/loop6 /nothing/dev/loop7 /nothing/dev/loop-control /nothing/dev/mapper /nothing/dev/mcelog /nothing/dev/media0 /nothing/dev/mei0 /nothing/dev/mem /nothing/dev/memory_bandwidth /nothing/dev/mqueue /nothing/dev/ndctl0 /nothing/dev/net /nothing/dev/network_latency /nothing/dev/network_throughput /nothing/dev/null /nothing/dev/port /nothing/dev/ppp /nothing/dev/psaux /nothing/dev/ptmx /nothing/dev/pts /nothing/dev/ram0 /nothing/dev/ram1 /nothing/dev/ram10 /nothing/dev/ram11 /nothing/dev/ram12 /nothing/dev/ram13 /nothing/dev/ram14 /nothing/dev/ram15 /nothing/dev/ram2 /nothing/dev/ram3 /nothing/dev/ram4 /nothing/dev/ram5 /nothing/dev/ram6 /nothing/dev/ram7 /nothing/dev/ram8 /nothing/dev/ram9 /nothing/dev/random /nothing/dev/rfkill /nothing/dev/rtc /nothing/dev/rtc0 /nothing/dev/sda /nothing/dev/sda1 /nothing/dev/sda2 /nothing/dev/sda3 /nothing/dev/sg0 /nothing/dev/sg1 /nothing/dev/shm /nothing/dev/snapshot /nothing/dev/snd /nothing/dev/sr0 /nothing/dev/stderr /nothing/dev/stdin /nothing/dev/stdout /nothing/dev/tty /nothing/dev/tty0 /nothing/dev/tty1 /nothing/dev/tty10 /nothing/dev/tty11 /nothing/dev/tty12 /nothing/dev/tty13 /nothing/dev/tty14 /nothing/dev/tty15 /nothing/dev/tty16 /nothing/dev/tty17 /nothing/dev/tty18 /nothing/dev/tty19 /nothing/dev/tty2 /nothing/dev/tty20 /nothing/dev/tty21 /nothing/dev/tty22 /nothing/dev/tty23 /nothing/dev/tty24 /nothing/dev/tty25 /nothing/dev/tty26 /nothing/dev/tty27 /nothing/dev/tty28 /nothing/dev/tty29 /nothing/dev/tty3 /nothing/dev/tty30 /nothing/dev/tty31 /nothing/dev/tty32 /nothing/dev/tty33 /nothing/dev/tty34 /nothing/dev/tty35 /nothing/dev/tty36 /nothing/dev/tty37 /nothing/dev/tty38 /nothing/dev/tty39 /nothing/dev/tty4 /nothing/dev/tty40 /nothing/dev/tty41 /nothing/dev/tty42 /nothing/dev/tty43 /nothing/dev/tty44 /nothing/dev/tty45 /nothing/dev/tty46 /nothing/dev/tty47 /nothing/dev/tty48 /nothing/dev/tty49 /nothing/dev/tty5 /nothing/dev/tty50 /nothing/dev/tty51 /nothing/dev/tty52 /nothing/dev/tty53 /nothing/dev/tty54 /nothing/dev/tty55 /nothing/dev/tty56 /nothing/dev/tty57 /nothing/dev/tty58 /nothing/dev/tty59 /nothing/dev/tty6 /nothing/dev/tty60 /nothing/dev/tty61 /nothing/dev/tty62 /nothing/dev/tty63 /nothing/dev/tty7 /nothing/dev/tty8 /nothing/dev/tty9 /nothing/dev/ttyprintk /nothing/dev/ttyS0 /nothing/dev/ttyS1 /nothing/dev/ttyS10 /nothing/dev/ttyS11 /nothing/dev/ttyS12 /nothing/dev/ttyS13 /nothing/dev/ttyS14 /nothing/dev/ttyS15 /nothing/dev/ttyS16 /nothing/dev/ttyS17 /nothing/dev/ttyS18 /nothing/dev/ttyS19 /nothing/dev/ttyS2 /nothing/dev/ttyS20 /nothing/dev/ttyS21 /nothing/dev/ttyS22 /nothing/dev/ttyS23 /nothing/dev/ttyS24 /nothing/dev/ttyS25 /nothing/dev/ttyS26 /nothing/dev/ttyS27 /nothing/dev/ttyS28 /nothing/dev/ttyS29 /nothing/dev/ttyS3 /nothing/dev/ttyS30 /nothing/dev/ttyS31 /nothing/dev/ttyS4 /nothing/dev/ttyS5 /nothing/dev/ttyS6 /nothing/dev/ttyS7 /nothing/dev/ttyS8 /nothing/dev/ttyS9 /nothing/dev/uhid /nothing/dev/uinput /nothing/dev/urandom /nothing/dev/v4l /nothing/dev/vboxdrv /nothing/dev/vboxdrvu /nothing/dev/vboxnetctl /nothing/dev/vboxusb /nothing/dev/vcs /nothing/dev/vcs1 /nothing/dev/vcs2 /nothing/dev/vcs3 /nothing/dev/vcs4 /nothing/dev/vcs5 /nothing/dev/vcs6 /nothing/dev/vcsa /nothing/dev/vcsa1 /nothing/dev/vcsa2 /nothing/dev/vcsa3 /nothing/dev/vcsa4 /nothing/dev/vcsa5 /nothing/dev/vcsa6 /nothing/dev/vfio /nothing/dev/vga_arbiter /nothing/dev/vhci /nothing/dev/vhost-net /nothing/dev/video0 /nothing/dev/xconsole /nothing/dev/zero
RUN touch /nothing/proc/1 /nothing/proc/10 /nothing/proc/1049 /nothing/proc/10508 /nothing/proc/1096 /nothing/proc/11 /nothing/proc/1106 /nothing/proc/1116 /nothing/proc/11198 /nothing/proc/11750 /nothing/proc/12 /nothing/proc/12038 /nothing/proc/1219 /nothing/proc/12515 /nothing/proc/1278 /nothing/proc/13 /nothing/proc/13014 /nothing/proc/1345 /nothing/proc/1369 /nothing/proc/1384 /nothing/proc/1385 /nothing/proc/1391 /nothing/proc/1393 /nothing/proc/14 /nothing/proc/14160 /nothing/proc/142 /nothing/proc/143 /nothing/proc/144 /nothing/proc/145 /nothing/proc/14554 /nothing/proc/14565 /nothing/proc/146 /nothing/proc/147 /nothing/proc/1477 /nothing/proc/148 /nothing/proc/1489 /nothing/proc/149 /nothing/proc/15 /nothing/proc/150 /nothing/proc/1504 /nothing/proc/1508 /nothing/proc/151 /nothing/proc/152 /nothing/proc/1522 /nothing/proc/15237 /nothing/proc/1524 /nothing/proc/153 /nothing/proc/1536 /nothing/proc/154 /nothing/proc/1542 /nothing/proc/1544 /nothing/proc/1547 /nothing/proc/1552 /nothing/proc/1553 /nothing/proc/1557 /nothing/proc/1558 /nothing/proc/1561 /nothing/proc/15655 /nothing/proc/1578 /nothing/proc/1583 /nothing/proc/1598 /nothing/proc/1604 /nothing/proc/1606 /nothing/proc/1614 /nothing/proc/1625 /nothing/proc/1636 /nothing/proc/1642 /nothing/proc/1650 /nothing/proc/1651 /nothing/proc/1652 /nothing/proc/1653 /nothing/proc/1654 /nothing/proc/1655 /nothing/proc/1665 /nothing/proc/1666 /nothing/proc/1680 /nothing/proc/17 /nothing/proc/1702 /nothing/proc/1711 /nothing/proc/1714 /nothing/proc/1723 /nothing/proc/1736 /nothing/proc/174 /nothing/proc/1744 /nothing/proc/177 /nothing/proc/1776 /nothing/proc/1778 /nothing/proc/1787 /nothing/proc/1791 /nothing/proc/1799 /nothing/proc/18 /nothing/proc/1804 /nothing/proc/1810 /nothing/proc/1813 /nothing/proc/1828 /nothing/proc/1838 /nothing/proc/1840 /nothing/proc/1858 /nothing/proc/1899 /nothing/proc/19 /nothing/proc/1905 /nothing/proc/1917 /nothing/proc/1925 /nothing/proc/1939 /nothing/proc/1945 /nothing/proc/1952 /nothing/proc/1977 /nothing/proc/1986 /nothing/proc/1987 /nothing/proc/1995 /nothing/proc/1997 /nothing/proc/2 /nothing/proc/20 /nothing/proc/2000 /nothing/proc/201 /nothing/proc/202 /nothing/proc/20280 /nothing/proc/2039 /nothing/proc/2041 /nothing/proc/20645 /nothing/proc/2069 /nothing/proc/2074 /nothing/proc/2076 /nothing/proc/2078 /nothing/proc/2079 /nothing/proc/2082 /nothing/proc/2086 /nothing/proc/21 /nothing/proc/22 /nothing/proc/22619 /nothing/proc/2306 /nothing/proc/234 /nothing/proc/2366 /nothing/proc/2376 /nothing/proc/2391 /nothing/proc/24 /nothing/proc/2400 /nothing/proc/24053 /nothing/proc/2418 /nothing/proc/2439 /nothing/proc/24870 /nothing/proc/25 /nothing/proc/25404 /nothing/proc/2550 /nothing/proc/25609 /nothing/proc/25614 /nothing/proc/257 /nothing/proc/26 /nothing/proc/2603 /nothing/proc/264 /nothing/proc/26906 /nothing/proc/27 /nothing/proc/28 /nothing/proc/29 /nothing/proc/29080 /nothing/proc/2917 /nothing/proc/2924 /nothing/proc/29367 /nothing/proc/29605 /nothing/proc/3 /nothing/proc/300 /nothing/proc/3025 /nothing/proc/30316 /nothing/proc/30338 /nothing/proc/30364 /nothing/proc/30794 /nothing/proc/31 /nothing/proc/32 /nothing/proc/322 /nothing/proc/32319 /nothing/proc/32368 /nothing/proc/33 /nothing/proc/34 /nothing/proc/35 /nothing/proc/36 /nothing/proc/360 /nothing/proc/3654 /nothing/proc/37 /nothing/proc/38 /nothing/proc/39 /nothing/proc/40 /nothing/proc/41 /nothing/proc/42 /nothing/proc/43 /nothing/proc/44 /nothing/proc/45 /nothing/proc/46 /nothing/proc/47 /nothing/proc/48 /nothing/proc/4989 /nothing/proc/5 /nothing/proc/53 /nothing/proc/54 /nothing/proc/55 /nothing/proc/56 /nothing/proc/575 /nothing/proc/6520 /nothing/proc/6534 /nothing/proc/6538 /nothing/proc/6540 /nothing/proc/665 /nothing/proc/667 /nothing/proc/668 /nothing/proc/67 /nothing/proc/670 /nothing/proc/674 /nothing/proc/676 /nothing/proc/678 /nothing/proc/68 /nothing/proc/682 /nothing/proc/694 /nothing/proc/7 /nothing/proc/7144 /nothing/proc/73 /nothing/proc/733 /nothing/proc/735 /nothing/proc/7357 /nothing/proc/737 /nothing/proc/740 /nothing/proc/745 /nothing/proc/752 /nothing/proc/753 /nothing/proc/7551 /nothing/proc/759 /nothing/proc/763 /nothing/proc/771 /nothing/proc/775 /nothing/proc/798 /nothing/proc/8 /nothing/proc/8075 /nothing/proc/819 /nothing/proc/824 /nothing/proc/8385 /nothing/proc/8387 /nothing/proc/846 /nothing/proc/859 /nothing/proc/8608 /nothing/proc/878 /nothing/proc/879 /nothing/proc/880 /nothing/proc/881 /nothing/proc/882 /nothing/proc/886 /nothing/proc/888 /nothing/proc/889 /nothing/proc/9 /nothing/proc/903 /nothing/proc/9101 /nothing/proc/93 /nothing/proc/94 /nothing/proc/acpi /nothing/proc/asound /nothing/proc/buddyinfo /nothing/proc/bus /nothing/proc/cgroups /nothing/proc/cmdline /nothing/proc/consoles /nothing/proc/cpuinfo /nothing/proc/crypto /nothing/proc/devices /nothing/proc/diskstats /nothing/proc/dma /nothing/proc/driver /nothing/proc/execdomains /nothing/proc/fb /nothing/proc/filesystems /nothing/proc/fs /nothing/proc/interrupts /nothing/proc/iomem /nothing/proc/ioports /nothing/proc/irq /nothing/proc/kallsyms /nothing/proc/kcore /nothing/proc/keys /nothing/proc/key-users /nothing/proc/kmsg /nothing/proc/kpagecount /nothing/proc/kpageflags /nothing/proc/loadavg /nothing/proc/locks /nothing/proc/mdstat /nothing/proc/meminfo /nothing/proc/misc /nothing/proc/modules /nothing/proc/mounts /nothing/proc/mtrr /nothing/proc/net /nothing/proc/pagetypeinfo /nothing/proc/partitions /nothing/proc/sched_debug /nothing/proc/schedstat /nothing/proc/scsi /nothing/proc/self /nothing/proc/slabinfo /nothing/proc/softirqs /nothing/proc/stat /nothing/proc/swaps /nothing/proc/sys /nothing/proc/sysrq-trigger /nothing/proc/sysvipc /nothing/proc/thread-self /nothing/proc/timer_list /nothing/proc/timer_stats /nothing/proc/tty /nothing/proc/uptime /nothing/proc/version /nothing/proc/version_signature /nothing/proc/vmallocinfo /nothing/proc/vmstat /nothing/proc/zoneinfo
RUN mkdir /nothing/dev/treasure/
RUN echo "XCTF{DANKMEMESCANTMELTSTEELBEAMS}" > /nothing/dev/treasure/fl_ag_come_at_me_bro

EXPOSE 22
CMD ["/usr/sbin/sshd", "-D"]
